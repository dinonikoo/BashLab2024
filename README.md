# BashLab2024
В этом репозитории содержатся два скрипта на Bash и два на PowerShell: archieve_script.sh и testcases_script.sh. Эти скрипты предназначены для архивации старых лог-файлов на основе порогов использования диска и для тестирования процесса архивации с помощью сгенерированных файлов.


# Скрипт 1: archieve_script.sh
## Описание
Скрипт archieve_script.sh проверяет указанную директорию на наличие старых лог-файлов. Если использование диска превышает заданный порог, он архивирует старые файлы в архив tar.gz и удаляет их из исходной директории.
## Использование
./archieve_script.sh <LOG_DIR> <BACKUP_DIR> <THRESHOLD> <N>
## Параметры
<LOG_DIR>: Путь к директории, содержащей лог-файлы.
<BACKUP_DIR>: Путь, по которому будет сохранен архив. Если эта директория не существует, она будет создана в домашней директории пользователя.
<THRESHOLD>: Процент порога использования диска для архивации файлов (например, 80).
<N>: Количество старых файлов, подлежащих архивированию.
## Пример
./archieve_script.sh /path/to/logs /path/to/backup 80 10
## Функциональность
Проверка существования директории: Проверяет, существует ли указанная директория с логами.
Расчет использования диска: Вычисляет текущее использование диска для директории логов.
Выбор файлов: Если использование диска превышает порог, выбирает N самых старых файлов для архивации.
Архивация: Создает архив tar.gz из выбранных файлов с отметкой времени.
Удаление файлов: Удаляет архивированные файлы из директории логов.
Обратная связь пользователю: Предоставляет вывод в консоль на каждом этапе


# Скрипт 2: testcases_script.sh
## Описание
Скрипт testcases_script.sh создает виртуальный диск, монтирует его, генерирует лог-файлы для тестирования и запускает скрипт archieve_script.sh, чтобы проверить его функциональность в разных сценариях.
## Использование
./testcases_script.sh
## Функциональность
Создание виртуального диска: Создает виртуальный диск размером 1 ГБ и форматирует его в файловую систему ext4.
Монтирование: Монтирует виртуальный диск в указанную точку монтирования и устанавливает права доступа.
Генерация лог-файлов: Генерирует лог-файлы размером 25 МБ каждый в зависимости от указанного количества.
Тестовые случаи: Выполняет несколько тестов с различными условиями, чтобы проверить работу скрипта архивации:
        Разные пороги и количество файлов для удаления.
        Сценарии, в которых лог-директория или директория для резервного копирования не существуют.
Очистка: Размонтирует виртуальный диск и удаляет все созданные файлы и директории.
## Примечания
Убедитесь, что скрипт выполняется в среде, где у вас есть необходимые права.
## Требования
Bash (Linux-среда).
Достаточно свободного места на диске для создания виртуального диска и лог-файлов.


# Скрипт 3: archive_script.ps1
## Описание
Скрипт archive_script.ps1 выполняет архивацию старых файлов из указанной директории, если текущий объем использованного дискового пространства превышает заданный порог. Файлы архивируются в формате .zip, после чего удаляются из исходной директории.
## Использование
.\archive_script.ps1 -sourcePath <string> -archivePath <string> -diskUsageThreshold <int> -fileCount <int> -maxSize <int64>
## Параметры
sourcePath: Путь к директории, содержащей файлы для архивации.
archivePath: Путь к директории, где будет создан архив. Если директория не существует, она создается.
diskUsageThreshold: Порог использования диска в процентах, после которого начинается архивация (например, 50).
fileCount: Количество самых старых файлов, подлежащих архивации.
maxSize: Максимальный размер директории sourcePath для контроля использования дискового пространства.
## Пример
.\archive_script.ps1 -sourcePath "C:\Logs" -archivePath "C:\Backup" -diskUsageThreshold 50 -fileCount 10 -maxSize 1GB
## Функциональность
Проверка параметров: Проверяет, заданы ли все параметры.
Расчет заполненности директории: Подсчитывает текущий размер директории и процент от максимального размера.
Условие архивации: Начинает архивацию, если текущая заполненность превышает порог.
Создание архива: Архивирует указанные файлы в архив .zip с именем archive.zip и сохраняет в директории archivePath.
Удаление файлов: Удаляет файлы, которые были архивированы, из директории sourcePath.
Сообщения: Информирует о ходе выполнения и возможных ошибках


# Скрипт 4: testcases_script.ps1
## Описание
Скрипт testcases_script.ps1 выполняет автоматическое тестирование работы скрипта archive_script.ps1. Он генерирует тестовые файлы и запускает сценарии тестирования для проверки различных условий, таких как пороги использования диска и количества архивируемых файлов.
## Использование
.\testcases_script.ps1
## Функциональность
Функция генерации файлов: Функция generate_test_files создает файлы заданного размера и количества в указанной директории для тестирования.
Запуск тестов: Функция run_test выполняет тест, запуская скрипт archive_script.ps1 с заданными параметрами. Скрипт проверяет, был ли успешно создан архив и удалены ли файлы.
Тестовые случаи: Выполняет несколько тестов с разными параметрами, такими как порог заполненности и количество файлов для архивации.
Сообщения: Выводит результаты каждого теста, указывая, был ли тест успешен или нет.
## Примеры тестов
Тест 1: Порог 50%, 10 файлов для архивации, максимум 1 ГБ.
Тест 2: Порог 30%, 15 файлов для архивации, максимум 1 ГБ.
Тест 3: Порог 80%, 10 файлов для архивации, максимум 1 ГБ.
Тест 4: Порог 50%, 20 файлов для архивации, максимум 2 ГБ.
## Примечания
Перед запуском скрипта убедитесь, что PowerShell настроен для выполнения скриптов (например, с помощью команды Set-ExecutionPolicy RemoteSigned).
Убедитесь, что на целевом диске достаточно места для создания тестовых файлов.
